// <script>
// initialize: function(){
//   this.ContactList = new ContactList({ view: this });
//   _.bindAll(this, 'render', 'unrender', 'add', 'edit', 'remove', 'search');
//   this.model.bind('add', options.view.addContact)
//   this.model.bind('edit', this.render);
//   this.model.bind('remove', this.unrender);
//   var self = this;
//   this.collection = new ContactList();
//   this.collection.fetch().done(function(){
//     self.render();
//   });
// },
// render:function(){
//   $(this.el).html('<td>' + Contact.name + '</td><td>'+ Contact.email + '</td><td>' + Contact.phone + '</td>');
//     _(this.collection.models).each(function(Contact){
//       self.appendContact(Contact);
//     });
//     return this;
//     collection.each(function(Contact){
//       console.log(Contact);
//     });
// }


// unrender: function(){
//           $(this.el).remove();
//         },

//         remove: function(){
//           this.contact.destroy();
//         },
//         search: function(){
//           this.contact.search();
//         }
//       });
// </script>
<!-- http://liquidmedia.org/blog/2011/02/backbone-js-part-3/ -->
<html>
<body>
  <h2>Contacts</h2>
  <table>
    <tr id="contacts"></tr>
  </table>
  
<script>

var contacts = new Contacts([
  { name: 'Bob', email: 'bob@mail.com', phone: '123-123-1234'},
  { name: 'Sarah', email: 'sarah@mail.com', phone: '123-123-1234'},
  { name: 'Joe', email: 'joe@mail.com', phone: '123-123-1234'},
  { name: 'Mary', email: 'mary@mail.com', phone: '123-123-1234'}
  ]);


var ContactCollectionView = Backbone.View.extend({
  collection:contacts.
  el:$('tr.contacts')[0]
  contactsCollectionView.render();
  initialize: function() {
    _(this).bindAll('add', 'remove');
    this._contactViews = [];
    this.collection.each(this.add);
    this.collection.bind('add', this.add);
    this.collection.bind('remove', this.remove);
    var that = this;
    this._contactsViews = [];

    this.collection.each(function(contact){
      that._contactViews.push(new UpdatingContactView({
        model: contact,
        tagName: 'td'
      }));
    });
  },

  render:function() {
    var that = this;
    $(this.el).empty();
    _(this._contactViews).each(function(cv) {
      $(that.el).append(cv.render().el);
    });
  },
  add: function(contact) {
    var cv = new UpdatingContactView ({
      tagName: 'td',
      model: contact
    });
    this._contactViews.push(cv);
    if (this._rendered){
      $(this.el).append(cv.render().el);
    }

  },
  remove: function(model) {
    var viewToRemove = _(this._contactViews).select(function(cv) { return cv.model === model; }) [0];
    this._contactViews = _(this._contactViews).without(viewToRemove);
    if(this._rendered) $(viewToRemove.el).remove(); 
  },
  render:function() {
    this._rendered = true;
    $(this.el).empty();
    _(this._contactViews).each(function(cv){
      this.$('td.contacts').append(cv.render().el);
    });
      return this;
  }

  var ContactCollectionView = new UpdatingContactView({
    collection: contacts,
    childViewConstructor: UpdatingContactView,
    childViewTagName: 'td',
    el : $('#contacts_list')[0]
  });
  var UpdatingContactView = Backbone.View.extend({
    initialize:function(options) {
      _(this).bindAll('add', 'remove');

      if(!options.childViewConstructor) throw "no child view constructor provided";
      if(!options.childViewTagName) throw "no child view tag name provided";

      this._childViewConstructor = options.childViewConstructor;
      this._childViewTagName = options.childViewTagName;
      this._childViews = [];
      this.collection.each(this.add);
      this.collection.bind('add', this.add);
      this.collection.bind('remove', this.remove);
    },
    add: function(model) {
      var childView = new this._childViewConstructor({
        tagName: this._childViewTagName,
        model: model
      });
      this._childViews.push(childView);

      if(this._rendered) {
        $(this.el).append(childView.render().el);
      }
    },
    remove: function(model) {
      var viewToRemove = _(this._childViews).select(function(childview) { return childview.model === model; })[0];
      this._childViews = _(this._childViews).without(viewToRemove);
      if (this._rendered) $(viewToRemove.el).remove();
    },
    render: function() {
      var that = this;
      this._rendered = true;
      $(this.el).empty();
      _(this._childViews).each(function(childView) {
        $(that.el).append(childView.render().el);
      });
      return this;
    }

    });

  var ContactListView = Backbone.View.extend({
    templateId: 'contact_list',
    initialize: function(){
      this.template = $.template(this.templateId);
      this._contactCollectionView = new UpdatingContactView({
        collection: this.model.contacts,
        childViewConstructor: UpdatingContactView,
        childViewTagName: 'td'
      });
    },
    render: function() {
      $(this.el).empty();
      $tmpl(this.template, this.model.toJSON()).appendTo(this.el);
      this._contactCollectionView.el = this.$('.contacts');
      this._contactCollectionView.render();
    }
  });
  var contactListView = new contactListView({ model: contactList});
  })
});

    // });
